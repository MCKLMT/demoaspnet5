stages:
  - stage: Build
    displayName: 'Build RM Azure WebApp'
    jobs:
    - template: azure-pipelines-build-template.yml
  - stage: 'DeployDev'
    dependsOn: Build
    variables:
    - group: 'webapp-dev-env-variable-group'
    jobs:
    - template: azure-pipelines-deployment-template.yml
      parameters:
        environment: 'Dev'
        webAppName: '$(WebAppName)'
        azureConnectionName: '$(AzureConnectionName)'
  - stage: 'DeployTest'
    dependsOn: Build
    variables:
    - group: 'webapp-test-env-variable-group'
    jobs:
    - template: azure-pipelines-deployment-template.yml
      parameters:
        environment: 'Test'
        webAppName: '$(WebAppName)'
        azureConnectionName: '$(AzureConnectionName)'
  - stage: 'DeployProd'
    dependsOn: Build
    variables:
    - group: 'webapp-prod-env-variable-group'
    jobs:
    - template: azure-pipelines-deployment-template.yml
      parameters:
        environment: 'Prod'
        webAppName: '$(WebAppName)'
        azureConnectionName: '$(AzureConnectionName)'